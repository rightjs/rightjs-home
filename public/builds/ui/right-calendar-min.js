/**
 * The calendar widget implemented with RightJS
 *
 * Home page: http://rightjs.org/ui/calendar
 *
 * @copyright (C) 2009 Nikolay V. Nemshilov aka St.
 */
if (!RightJS) { throw "Gimme RightJS. Please." };
var Calendar=new Class(Observer,{extend:{EVENTS:$w('show hide select done'),Options:{format:'ISO',showTime:null,showButtons:false,minDate:null,maxDate:null,firstDay:1,fxName:'fade',fxDuration:200,numberOfMonths:1,timePeriod:1,checkTags:'*',relName:'calendar',twentyFourHour:null},Formats:{ISO:'%Y-%m-%d',POSIX:'%Y/%m/%d',EUR:'%d-%m-%Y',US:'%m/%d/%Y'},i18n:{Done:'Done',Now:'Now',Next:'Next Month',Prev:'Previous Month',NextYear:'Next Year',PrevYear:'Prev Year',dayNames:$w('Sunday Monday Tuesday Wednesday Thursday Friday Saturday'),dayNamesShort:$w('Sun Mon Tue Wed Thu Fri Sat'),dayNamesMin:$w('Su Mo Tu We Th Fr Sa'),monthNames:$w('January February March April May June July August September October November December'),monthNamesShort:$w('Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec')},rescan:function(){var k=Calendar.Options.relName;var a=new RegExp(k+'\\[(.+?)\\]');$$(Calendar.Options.checkTags+'[rel*='+k+']').each(function(e){var d=e.get('data-'+k+'-options');var c=new Calendar(eval('('+d+')')||{});var r=e.get('rel').match(a);if(r){var i=$(r[1]);if(i)c.assignTo(i,e)}else c.assignTo(e)})}},initialize:function(o){this.$super(o);this.element=$E('div',{'class':'right-calendar'});this.build().connectEvents().setDate(new Date())},setOptions:function(u){this.$super(u);var a=this.constructor;var o=this.options;with(this.options){o.i18n={};for(var k in a.i18n)i18n[k]=isArray(a.i18n[k])?a.i18n[k].clone():a.i18n[k];$ext(i18n,(u||{}).i18n);o.dayNames=i18n.dayNamesMin;if(firstDay)dayNames.push(dayNames.shift());if(!isArray(numberOfMonths))numberOfMonths=[numberOfMonths,1];if(minDate)minDate=this.parse(minDate);if(maxDate){maxDate=this.parse(maxDate);maxDate.setDate(maxDate.getDate()+1)}format=(a.Formats[format]||format).trim();if(showTime===null)showTime=format.search(/%[HkIl]/)>-1;if(twentyFourHour===null)twentyFourHour=format.search(/%[Il]/)<0;if(timePeriod>60&&12 %(timePeriod/60).ceil())twentyFourHour=true}return this},setDate:function(d){this.date=this.prevDate=this.parse(d);return this.update()},getDate:function(){return this.date},hide:function(){this.element.hide(this.options.fxName,{duration:this.options.fxDuration});Calendar.current=null;return this},show:function(p){this.element.show(this.options.fxName,{duration:this.options.fxDuration});Calendar.current=this;return this},insertTo:function(e,p){this.element.addClass('right-calendar-inline').insertTo(e,p);return this}});Calendar.include({update:function(d){var d=new Date(d||this.date),o=this.options;var a=this.element.select('div.right-calendar-month');var b=a.length;for(var i=-(b-b/2).ceil()+1;i<(b-b/2).floor()+1;i++){var m=new Date(d);m.setMonth(d.getMonth()+i);this.updateMonth(a.shift(),m)}this.updateNextPrevMonthButtons(d,b);if(o.showTime){this.hours.value=o.timePeriod<60?d.getHours():(d.getHours()/(o.timePeriod/60)).round()*(o.timePeriod/60);this.minutes.value=(d.getMinutes()/(o.timePeriod % 60)).round()*o.timePeriod}return this},updateMonth:function(g,d){d.setDate(32);var f=32-d.getDate();d.setMonth(d.getMonth()-1);var b=(this.date.getTime()/86400000).ceil();var r=g.select('tbody tr');var a=r.shift().select('td');g.select('tbody td').each(function(t){t.innerHTML='';t.className='right-calendar-day-blank'});var o=this.options;for(var i=1;i<=f;i++){d.setDate(i);var e=d.getDay();if(this.options.firstDay)e=e?e-1:6;a[e].innerHTML=''+i;a[e].className=b==(d.getTime()/86400000).ceil()?'right-calendar-day-selected':'';if((o.minDate&&o.minDate>d)||(o.maxDate&&o.maxDate<d))a[e].className='right-calendar-day-disabled';a[e].date=new Date(d);if(e==6)a=r.shift().select('td')}var c=(o.listYears?o.i18n.monthNamesShort[d.getMonth()]+',':o.i18n.monthNames[d.getMonth()])+' '+d.getFullYear();g.first('div.right-calendar-month-caption').update(c)},updateNextPrevMonthButtons:function(a,f){var o=this.options;if(o.minDate){var b=new Date(a.getFullYear(),0,1,0,0,0);var c=new Date(o.minDate.getFullYear(),0,1,0,0,0);this.hasPrevYear=b>c;b.setMonth(a.getMonth()-(f-f/2).ceil());c.setMonth(o.minDate.getMonth());this.hasPrevMonth=b>=c}else this.hasPrevMonth=this.hasPrevYear=true;if(o.maxDate){var e=new Date(a);var m=new Date(o.maxDate);[e,m].each(function(d){d.setDate(32);d.setMonth(d.getMonth()-1);d.setDate(32-d.getDate());d.setHours(0);d.setMinutes(0);d.setSeconds(0);d.setMilliseconds(0)});this.hasNextMonth=e<m;[e,m].each('setMonth',0);this.hasNextYear=e<m}else this.hasNextMonth=this.hasNextYear=true;this.nextButton[this.hasNextMonth?'removeClass':'addClass']('right-ui-button-disabled');this.prevButton[this.hasPrevMonth?'removeClass':'addClass']('right-ui-button-disabled');if(this.nextYearButton){this.nextYearButton[this.hasNextYear?'removeClass':'addClass']('right-ui-button-disabled');this.prevYearButton[this.hasPrevYear?'removeClass':'addClass']('right-ui-button-disabled')}},build:function(){this.buildSwaps();var g=tbody=$E('table',{'class':'right-calendar-greed'}).insertTo(this.element);var o=this.options;if(Browser.OLD)tbody=$E('tbody').insertTo(g);for(var y=0;y<o.numberOfMonths[1];y++){var r=$E('tr').insertTo(tbody);for(var x=0;x<o.numberOfMonths[0];x++)$E('td').insertTo(r).insert(this.buildMonth())}if(o.showTime)this.buildTime();this.buildButtons();return this},buildSwaps:function(){var i=this.options.i18n;this.prevButton=$E('div',{'class':'right-ui-button right-calendar-prev-button',html:'&lsaquo;',title:i.Prev}).insertTo(this.element);this.nextButton=$E('div',{'class':'right-ui-button right-calendar-next-button',html:'&rsaquo;',title:i.Next}).insertTo(this.element);if(this.options.listYears){this.prevYearButton=$E('div',{'class':'right-ui-button right-calendar-prev-year-button',html:'&laquo;',title:i.PrevYear}).insertTo(this.prevButton,'after');this.nextYearButton=$E('div',{'class':'right-ui-button right-calendar-next-year-button',html:'&raquo;',title:i.NextYear}).insertTo(this.nextButton,'before')}},buildMonth:function(){return $E('div',{'class':'right-calendar-month'}).insert('<div class="right-calendar-month-caption"></div>'+'<table><thead><tr>'+this.options.dayNames.map(function(n){return '<th>'+n+'</th>'}).join('')+'</tr></thead><tbody>'+'123456'.split('').map(function(){return '<tr><td><td><td><td><td><td><td></tr>'}).join('')+'</tbody></table>')},buildTime:function(){var o=this.options;var t=$E('div',{'class':'right-calendar-time',html:':'}).insertTo(this.element);this.hours=$E('select').insertTo(t,'top');this.minutes=$E('select').insertTo(t);var m=o.timePeriod<60?o.timePeriod:60;var h=o.timePeriod<60?1:(o.timePeriod/60).ceil();(60).times(function(a){var c=(a<10?'0':'')+a;if(a<24&&a % h==0){if(o.twentyFourHour)this.hours.insert($E('option',{value:a,html:c}));else if(a<12)this.hours.insert($E('option',{value:a,html:a==0?12:a}))}if(a % m==0)this.minutes.insert($E('option',{value:a,html:c}))},this);if(!o.twentyFourHour){this.meridian=$E('select').insertTo(t);(o.format.includes(/%P/)?['am','pm']:['AM','PM']).each(function(v){this.meridian.insert($E('option',{value:v.toLowerCase(),html:v}))},this)}},buildButtons:function(){if(!this.options.showButtons)return;this.nowButton=$E('div',{'class':'right-ui-button right-calendar-now-button',html:this.options.i18n.Now});this.doneButton=$E('div',{'class':'right-ui-button right-calendar-done-button',html:this.options.i18n.Done});$E('div',{'class':'right-ui-buttons right-calendar-buttons'}).insert([this.doneButton,this.nowButton]).insertTo(this.element)}});document.onKeydown(function(e){if(Calendar.current){var n;switch(e.keyCode){case 27:n='hide';break;case 37:n='prevDay';break;case 39:n='nextDay';break;case 38:n='prevWeek';break;case 40:n='nextWeek';break;case 34:n='nextMonth';break;case 33:n='prevMonth';break;case 13:Calendar.current.select(Calendar.current.date);n='done';break}if(n){Calendar.current[n]();e.stop()}}});Calendar.include({select:function(d){this.date=d;return this.fire('select',d)},done:function(){if(!this.element.hasClass('right-calendar-inline'))this.hide();return this.fire('done',this.date)},nextDay:function(){return this.changeDate({'Date':1})},prevDay:function(){return this.changeDate({'Date':-1})},nextWeek:function(){return this.changeDate({'Date':7})},prevWeek:function(){return this.changeDate({'Date':-7})},nextMonth:function(){return this.changeDate({Month:1})},prevMonth:function(){return this.changeDate({Month:-1})},nextYear:function(){return this.changeDate({FullYear:1})},prevYear:function(){return this.changeDate({FullYear:-1})},changeDate:function(h){var d=new Date(this.date);for(var k in h)d['set'+k](d['get'+k]()+h[k]);if(!((this.options.minDate&&this.options.minDate>d)||(this.options.maxDate&&this.options.maxDate<d)))this.date=d;return this.update(this.date)},connectEvents:function(){this.prevButton.onClick(this.prevMonth.bind(this));this.nextButton.onClick(this.nextMonth.bind(this));if(this.nextYearButton){this.prevYearButton.onClick(this.prevYear.bind(this));this.nextYearButton.onClick(this.nextYear.bind(this))}this.element.select('div.right-calendar-month table tbody td').each(function(c){c.onClick(function(){if(c.innerHTML!=''){var p=this.element.first('.right-calendar-day-selected');if(p)p.removeClass('right-calendar-day-selected');c.addClass('right-calendar-day-selected');this.setTime(c.date)}}.bind(this))},this);if(this.hours){this.hours.on('change',this.setTime.bind(this));this.minutes.on('change',this.setTime.bind(this));if(!this.options.twentyFourHour)this.meridian.on('change',this.setTime.bind(this))}if(this.nowButton){this.nowButton.onClick(this.setDate.bind(this,new Date()));this.doneButton.onClick(this.done.bind(this))}this.element.onClick(function(a){a.stop()});return this},setTime:function(d){if(d instanceof Date){this.date.setYear(d.getFullYear());this.date.setMonth(d.getMonth());this.date.setDate(d.getDate())}if(this.hours){this.date.setHours(this.hours.value.toInt()+(!this.options.twentyFourHour&&this.meridian.value=='pm'?12:0));this.date.setMinutes(this.minutes.value)}return this.select(this.date)}});Calendar.include({assignTo:function(i,t){var i=$(i),t=$(t);if(t)t.onClick(function(a){a.stop();this.showAt(i.focus())}.bind(this));else i.on({focus:this.showAt.bind(this,i),click:function(a){a.stop();if(this.element.hidden())this.showAt(i)}.bind(this),keyDown:function(a){if(a.keyCode==9&&this.element.visible())this.hide()}.bind(this)});document.onClick(this.hide.bind(this));return this},showAt:function(e){var e=$(e),d=e.dimensions();this.setDate(this.parse(e.value));this.element.setStyle({position:'absolute',margin:'0',left:(d.left)+'px',top:(d.top+d.height)+'px'}).insertTo(document.body);this.stopObserving('select').stopObserving('done');this.on(this.doneButton?'done':'select',function(){e.value=this.format()}.bind(this));return this.hideOthers().show()},toggleAt:function(i){if(this.element.parentNode&&this.element.visible())this.hide();else this.showAt(i);return this},hideOthers:function(){$$('div.right-calendar').each(function(e){if(!e.hasClass('right-calendar-inline')){if(e!=this.element)e.hide()}});return this}});Calendar.include({parse:function(g){var d;if(g instanceof Date||Date.parse(g))d=new Date(g);else if(isString(g)&&g){var t=RegExp.escape(this.options.format);var h=t.match(/%[a-z]/ig).map('match',/[a-z]$/i).map('first').without('%');var r=new RegExp('^'+t.replace(/%p/i,'(pm|PM|am|AM)').replace(/(%[a-z])/ig,'(.+?)')+'$');var m=g.trim().match(r);if(m){m.shift();var y=null,f=null,d=null,b=null,e=null,s=null,c;while(m.length){var v=m.shift();var k=h.shift();if(k.toLowerCase()=='b')f=this.options.i18n[k=='b'?'monthNamesShort':'monthNames'].indexOf(v);else if(k.toLowerCase()=='p')c=v.toLowerCase();else{v=v.toInt();switch(k){case 'd':case 'e':d=v;break;case 'm':f=v-1;break;case 'y':case 'Y':y=v;break;case 'H':case 'k':case 'I':case 'l':b=v;break;case 'M':e=v;break;case 'S':s=v;break}}}if(c){b=b==12?0:b;b=(c=='pm'?b+12:b)}d=new Date(y,f,d,b,e,s)}}else d=new Date();return d},format:function(g){var j=this.options.i18n;var f=this.date.getDay();var q=this.date.getMonth();var c=this.date.getDate();var t=this.date.getFullYear();var h=this.date.getHours();var o=this.date.getMinutes();var s=this.date.getSeconds();var i=(h==0?12:h<13?h:h-12);var v={a:j.dayNamesShort[f],A:j.dayNames[f],b:j.monthNamesShort[q],B:j.monthNames[q],d:(c<10?'0':'')+c,e:''+c,m:(q<9?'0':'')+(q+1),y:(''+t).substring(2,4),Y:''+t,H:(h<10?'0':'')+h,k:''+h,I:(h>0&&(h<10||(h>12&&h<22))?'0':'')+i,l:''+i,p:h<12?'AM':'PM',P:h<12?'am':'pm',M:(o<10?'0':'')+o,S:(s<10?'0':'')+s,'%':'%'};var r=g||this.options.format;for(var n in v)r=r.replace('%'+n,v[n]);return r}});document.onReady(Calendar.rescan);document.write("<style type=\"text/css\">*.right-ui-button{display:inline-block;*display:inline;*zoom:1;height:1em;line-height:1em;padding:.2em .5em;text-align:center;border:1px solid #CCC;border-radius:.2em;-moz-border-radius:.2em;-webkit-border-radius:.2em;cursor:pointer;color:#555;background-color:#FFF}*.right-ui-button:hover{color:#222;border-color:#999;background-color:#CCC}*.right-ui-button-disabled,*.right-ui-button-disabled:hover{color:#888;background:#EEE;border-color:#CCC;cursor:default}*.right-ui-buttons{margin-top:.5em}div.right-calendar{position:absolute;height:auto;border:1px solid #BBB;position:relative;padding:.5em;border-radius:.3em;-moz-border-radius:.3em;-webkit-border-radius:.3em;cursor:default;background-color:#EEE;-moz-box-shadow:.2em .4em .8em #666;-webkit-box-shadow:.2em .4em .8em #666}div.right-calendar-inline{position:relative;display:inline-block;*display:inline;*zoom:1;-moz-box-shadow:none;-webkit-box-shadow:none}div.right-calendar-prev-button,div.right-calendar-next-button,div.right-calendar-prev-year-button,div.right-calendar-next-year-button{position:absolute;float:left;width:1em;padding:.15em .4em}div.right-calendar-next-button{right:.5em}div.right-calendar-prev-year-button{left:2.55em}div.right-calendar-next-year-button{right:2.55em}div.right-calendar-month-caption{text-align:center;height:1.2em;line-height:1.2em}table.right-calendar-greed{border-spacing:0px;border:none;background:none;width:auto}table.right-calendar-greed td{vertical-align:top;border:none;background:none;margin:0;padding:0;padding-right:.4em}table.right-calendar-greed td:last-child{padding:0}div.right-calendar-month table{margin:0;padding:0;border:none;width:auto;margin-top:.2em;border-spacing:1px;border-collapse:separate;border:none;background:none}div.right-calendar-month table th{color:#777;text-align:center;border:none;background:none;padding:0;margin:0}div.right-calendar-month table td,div.right-calendar-month table td:last-child{text-align:right;padding:.1em .3em;background-color:#FFF;border:1px solid #CCC;cursor:pointer;color:#555;border-radius:.2em;-moz-border-radius:.2em;-webkit-border-radius:.2em}div.right-calendar-month table td:hover{background-color:#CCC;border-color:#AAA;color:#000}div.right-calendar-month table td.right-calendar-day-blank{background:transparent;cursor:default;border:none}div.right-calendar-month table td.right-calendar-day-selected{background-color:#BBB;border-color:#AAA;color:#222;font-weight:bold;padding:.1em .2em}div.right-calendar-month table td.right-calendar-day-disabled{color:#888;background:#EEE;border-color:#CCC;cursor:default}div.right-calendar-time{border-top:1px solid #ccc;margin-top:.3em;padding-top:.5em;text-align:center}div.right-calendar-time select{margin:0 .4em}div.right-calendar-buttons div.right-ui-button{width:3.2em}div.right-calendar-done-button{position:absolute;right:.5em}</style>");