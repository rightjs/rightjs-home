/**
 * The lightbox widget implemented with RightJS
 *
 * Home page: http://rightjs.org/ui/lightbox
 *
 * @copyright (C) 2009 Nikolay V. Nemshilov aka St.
 */
if (!RightJS || !Fx) { throw "Gimme RightJS with Fx. Please." };
Browser.IE6=navigator.userAgent.indexOf("MSIE 6")!=-1;var Lightbox=new Class({include:Options,extend:{Version:"1.0.0",Options:{endOpacity:0.8,fxDuration:200,hideOnEsc:true,hideOnOutClick:true,showCloseButton:true,blockContent:false,relName:'lightbox'},i18n:{CloseText:'&times;',CloseTitle:'Close',PrevText:'&lsaquo;&lsaquo;&lsaquo;',PrevTitle:'Previous Image',NextText:'&rsaquo;&rsaquo;&rsaquo;',NextTitle:'Next Image'},boxes:[]},initialize:function(o){this.setOptions(o).build().connectEvents();Lightbox.boxes.push(this)},setTitle:function(t){this.caption.fade('out',{duration:this.options.fxDuration/2,onFinish:function(){this.caption.update(t).fade('in',{duration:this.options.fxDuration/2})}.bind(this)});return this},hide:function(){this.element.hide('fade',{duration:this.options.fxDuration/2,onFinish:this.element.remove.bind(this.element)});return this},show:function(c,s){return this.showingSelf(function(){this.lock();this.content.update(c||'');this.resize(s)}.bind(this))},resize:function(s,n){this.dialog.style.top=(window.sizes().y-this.dialog.sizes().y)/2+'px';var a=this.contentSize(s);var h=this.dialog.sizes().y-this.body.sizes().y;var b=a.height.toInt()||this.minBodyHeight();var d={top:(this.element.sizes().y-b-h)/2+'px'};if(Browser.IE6){var p=this.bodyWrap.getStyle('padding').toInt()>0?15:0;this.bodyWrap.setStyle('padding: '+p+'px');d.width=(a.width.toInt()+p*2)+'px'}if(n===true){this.body.setStyle(a);this.dialog.setStyle(d);this.loading=false}else this.resizeFx(a,d);return this},lock:function(){this.bodyLock.removeClass('lightbox-body-lock-transparent').removeClass('lightbox-body-lock-loading').show();if(Browser.OLD)this.bodyLock.setStyle("opacity: 1");return this},unlock:function(){if(this.options.blockContent)this.bodyLock.addClass('lightbox-body-lock-transparent');else this.bodyLock.hide();return this},resizeLock:function(){this.lock().content.hide()},resizeUnlock:function(){this.unlock().content.show('fade',{duration:this.options.fxDuration/2});this.loading=false},contentSize:function(s){var s=s===this.$listeners?null:s,a=this.element.offsetWidth*0.8,m=this.element.offsetHeight*0.8;if(s)this.content.setStyle(s);s=this.content.sizes();return{width:(s.x>a?a:s.x)+"px",height:(s.y>m?m:s.y)+"px"}},boxResize:function(r){this.element.resize(window.sizes());if(Browser.IE6){this.locker.resize(window.sizes());this.element.style.position='absolute';this.element.style.top=document.documentElement.scrollTop+'px'}return this.resize(false,true)},showingSelf:function(c){Lightbox.boxes.without(this).each('hide');if(this.element.hidden()){this.locker.setStyle('opacity:0');this.dialog.setStyle('opacity:0');this.element.insertTo(document.body).show();this.boxResize();this.locker.morph({opacity:this.options.endOpacity},{duration:this.options.fxDuration});this.dialog.morph({opacity:1},{duration:this.options.fxDuration});c.delay(this.options.fxDuration)}else c();return this},build:function(){this.element=this.E('lightbox').setStyle('display: none');this.locker=this.E('lightbox-locker',this.element);this.dialog=this.E('lightbox-dialog',this.element);this.caption=this.E('lightbox-caption',this.dialog);this.bodyWrap=this.E('lightbox-body-wrap',this.dialog);this.body=this.E('lightbox-body',this.bodyWrap);this.content=this.E('lightbox-content',this.body);this.bodyLock=this.E('lightbox-body-lock',this.body).hide();if(this.options.showCloseButton)this.closeButton=this.E('lightbox-close-button',this.dialog).onClick(this.hide.bind(this)).update(Lightbox.i18n.CloseText).set('title',Lightbox.i18n.CloseTitle);if(this.options.hideOnOutClick)this.locker.onClick(this.hide.bind(this));document.on('mousewheel',function(a){if(this.element.visible()){a.stop();this[(a.detail||-a.wheelDelta)<0?'showPrev':'showNext']()}}.bind(this));return this},connectEvents:function(){if(this.options.hideOnEsc)document.onKeydown(function(e){if(e.keyCode==27){e.stop();this.hide()}}.bindAsEventListener(this));window.on('resize',this.boxResize.bind(this));return this},minBodyHeight:function(){var e=$E('div',{'class':'lightbox-body',style:'background: none; position: absolute'}).insertTo(document.body),h=e.sizes().y;e.remove();return h},resizeFx:function(g,m){this.resizeLock();var f=this.body.sizes().x;var c=g.width.toInt();var e=this.body.sizes().y;var a=g.height.toInt();var k=this.dialog.style.top.toInt();var i=m.top.toInt();var l=this.dialog.sizes().x;var j=(m.width||'0').toInt();var b=this.body;var h=this.dialog;$ext(new Fx(this.dialog,{duration:this.options.fxDuration}),{render:function(d){b.style.width=(f+(c-f)*d)+'px';b.style.height=(e+(a-e)*d)+'px';h.style.top=(k+(i-k)*d)+'px';if(Browser.IE6)h.style.width=(l+(j-l)*d)+'px'}}).onFinish(this.resizeUnlock.bind(this)).start()},E:function(k,p){var e=$E('div',{'class':k});if(p)e.insertTo(p);return e}});Lightbox.include((function(){var f=Lightbox.prototype.show;var e=Lightbox.prototype.build;return{show:function(c){if(c&&c.href)return this.load(c.href,{onComplete:function(r){this.setTitle(c.title).content.update(r.responseText)}.bind(this)});else return f.apply(this,arguments)},load:function(u,o){var o=o||{};$w('onCreate onComplete').each(function(n){o[n]=o[n]?isArray(o[n])?o[n]:[o[n]]:[]});if(o.onComplete.empty()&&!o.onSuccess)o.onComplete.push(function(r){this.content.update(r.responseText)}.bind(this));o.onCreate.unshift(this.loadLock.bind(this));o.onComplete.push(this.resize.bind(this));o.method=o.method||'get';return this.showingSelf(Xhr.load.bind(Xhr,u,o))},loadLock:function(){this.loading=true;this.lock().bodyLock.addClass('lightbox-body-lock-loading');return this},build:function(){var r=e.apply(this,arguments);var s=this.E('lightbox-body-lock-spinner',this.bodyLock);var b='1234'.split('').map(function(a){return $E('div',{html:'.','class':a==1?'glow':null}).insertTo(s)});(function(){var d=b.pop();d.insertTo(s,'top');b.unshift(d)}).periodical(400);return r}}})());Lightbox.include((function(){var b=Lightbox.prototype.show;var o=Lightbox.prototype.build;var a=Lightbox.prototype.connectEvents;return{show:function(c){this.roadLink=(c&&c.roadtrip)?c:null;return b.apply(this,arguments)},build:function(){var r=o.apply(this,arguments);this.prevLink=this.E('lightbox-prev-link',this.dialog).onClick(this.showPrev.bind(this)).update(Lightbox.i18n.PrevText).set('title',Lightbox.i18n.PrevTitle).hide();this.nextLink=this.E('lightbox-next-link',this.dialog).onClick(this.showNext.bind(this)).update(Lightbox.i18n.NextText).set('title',Lightbox.i18n.NextTitle).hide();return r},connectEvents:function(){var r=a.apply(this,arguments);document.onKeydown(function(e){if(e.keyCode==37){e.stop();this.showPrev()}if(e.keyCode==39){e.stop();this.showNext()}}.bind(this));return r},showPrev:function(){if(this.hasPrev()&&this.element.visible()&&!this.loading)this.show(this.roadLink.roadtrip[this.roadLink.roadtrip.indexOf(this.roadLink)-1]);return this},showNext:function(){if(this.hasNext()&&this.element.visible()&&!this.loading)this.show(this.roadLink.roadtrip[this.roadLink.roadtrip.indexOf(this.roadLink)+1]);return this},checkRoadtrip:function(){this.prevLink[this.hasPrev()?'show':'hide']();this.nextLink[this.hasNext()?'show':'hide']();return this},hasPrev:function(){return this.roadLink&&this.roadLink.roadtrip&&this.roadLink.roadtrip.first()!=this.roadLink},hasNext:function(){return this.roadLink&&this.roadLink.roadtrip&&this.roadLink.roadtrip.last()!=this.roadLink}}})());Lightbox.include((function(){var o=Lightbox.prototype.show;return{IMAGE_FORMATS:$w('jpg jpeg gif png bmp'),show:function(c){this.element[(c&&(c.tagName=='IMG'||this.isImageUrl(c.href)))?'addClass':'removeClass']('lightbox-image');if(c&&c.href&&this.isImageUrl(c.href))return this.showingSelf(function(){this.loadLock().roadLink=c;var i=new Image();i.onload=this.updateImage.bind(this,i,c);i.src=c.href}.bind(this));else return o.apply(this,arguments)},updateImage:function(i,l){this.content.update(i);this.checkRoadtrip().setTitle(l.title).resize()},isImageUrl:function(u){return this.IMAGE_FORMATS.include(String(u).toLowerCase().split('.').last())}}})());Lightbox.extend({hide:function(){this.boxes.each('hide')},show:function(){return this.inst('show',arguments)},load:function(){return this.inst('load',arguments)},inst:function(n,a){var i=new Lightbox();return i[n].apply(i,a)}});document.onReady(function(){$$('a[rel='+Lightbox.Options.relName+']').each(function(b){b.onClick(function(e){e.stop();Lightbox.show(this)})});var r=$$('a[rel="'+Lightbox.Options.relName+'[roadtrip]"]');r.each(function(b){b.roadtrip=r;b.onClick(function(e){e.stop();Lightbox.show(this)})})});document.write("<style type=\"text/css\">div.lightbox{position:fixed;top:0px;left:0px;width:100%;text-align:center}div.lightbox div{line-height:normal}div.lightbox-locker{position:absolute;top:0px;left:0px;width:100%;height:100%;background-color:black}div.lightbox-dialog{display:inline-block;*display:inline;*zoom:1;position:relative;text-align:left;padding-bottom:1.6em}div.lightbox-body-wrap{background-color:white;padding:1em;border-radius:.6em;-moz-border-radius:.6em;-webkit-border-radius:.6em}div.lightbox-body{position:relative;height:10em;width:10em;min-height:10em;min-width:10em;overflow:hidden;*background-color:white}div.lightbox-content{position:absolute;*background-color:white}div.lightbox-body-lock{background-color:white;position:absolute;left:0px;top:0px;width:100%;height:100%;text-align:center}div.lightbox-body-lock-spinner{display:none;position:absolute;bottom:0;right:0}div.lightbox-body-lock-spinner div{float:left;font-size:200%;font-family:Georgia;font-weight:bold;line-height:20pt;color:#AAA}div.lightbox-body-lock-spinner div.glow{color:#666;font-size:300%;margin-top:-3pt}div.lightbox-body-lock-loading div.lightbox-body-lock-spinner{display:inline-block;*display:inline;*zoom:1}div.lightbox-body-lock-transparent{background:none}div.lightbox-caption{height:1.2em;margin:0 .7em;margin-bottom:.1em;white-space:nowrap;color:#DDD;font-weight:bold;font-size:1.6em;font-family:Helvetica;text-shadow:black 2px 2px 2px}div.lightbox-close-button,div.lightbox-prev-link,div.lightbox-next-link{position:absolute;bottom:0;color:#888;cursor:pointer;font-size:150%;font-weight:bold}div.lightbox-close-button:hover,div.lightbox-prev-link:hover,div.lightbox-next-link:hover{color:white}div.lightbox-close-button{right:.5em}div.lightbox-prev-link,div.lightbox-next-link{padding:0 .2em;font-size:180%}div.lightbox-prev-link{left:.3em}div.lightbox-next-link{left:2em}div.lightbox-image div.lightbox-body-wrap{padding:0;border:1px solid #777;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px}div.lightbox-image div.lightbox-content img{vertical-align:middle}div.lightbox-image div.lightbox-caption{margin-left:.2em}div.lightbox-image div.lightbox-body-wrap,div.lightbox-image div.lightbox-body-lock{background-color:#DDD}div.lightbox-image div.lightbox-body-lock-spinner{bottom:1em;right:1em}div.lightbox-image div.lightbox-close-button{right:.2em}div.lightbox-image div.lightbox-prev-link{left:0}</style>");